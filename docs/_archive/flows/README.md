# INVS Modern - Flow Documentation
## ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞ Workflows

---

## üìö **‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£**

### üöÄ **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:**
- **[QUICK_START_GUIDE.md](./QUICK_START_GUIDE.md)**
  - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
  - ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô
  - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
  - Troubleshooting

- **[DATA_FLOW_COMPLETE_GUIDE.md](./DATA_FLOW_COMPLETE_GUIDE.md)** ‚≠ê
  - **Master Index** - ‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏∏‡∏Å flow ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  - ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  - End-to-end example
  - Database state tracking
  - KPIs ‡πÅ‡∏•‡∏∞ monitoring queries

---

## üìñ **‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Flow ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î**

### 1Ô∏è‚É£ **FLOW 01: Master Data Setup**
üìÑ **[FLOW_01_Master_Data_Setup.md](./FLOW_01_Master_Data_Setup.md)**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- Locations Setup (‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö)
- Departments Setup (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô)
- Budget Types Setup (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)
- Companies Setup (‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï/‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢)
- Drug Generics Setup (‡∏¢‡∏≤‡∏™‡∏≤‡∏°‡∏±‡∏ç)
- Drugs Setup (‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤)

**‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:**
- ‚úÖ UI Mockups ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
- ‚úÖ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå
- ‚úÖ SQL INSERT statements
- ‚úÖ Validation rules
- ‚úÖ Success criteria checklist

---

### 2Ô∏è‚É£ **FLOW 02: Budget Management**
üìÑ **[FLOW_02_Budget_Management.md](./FLOW_02_Budget_Management.md)**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- Budget Planning (‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)
- Budget Allocation (‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™)
- Budget Availability Check (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ö‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠)
- Budget Reservation (‡∏à‡∏≠‡∏á‡∏á‡∏ö‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PR)
- Budget Commitment (‡∏´‡∏±‡∏Å‡∏á‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ PO)
- Budget Monitoring (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢)

**‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:**
- ‚úÖ 5 Phases workflow
- ‚úÖ UI Mockups (Allocation form, Check dialog, Dashboard)
- ‚úÖ Database Functions usage
- ‚úÖ Budget calculation examples
- ‚úÖ Real-time monitoring queries

**Key Functions:**
```sql
check_budget_availability()
reserve_budget()
commit_budget()
release_budget_reservation()
```

---

### 3Ô∏è‚É£ **FLOW 03: Procurement Workflow**

#### Part 1: Purchase Request (PR)
üìÑ **[FLOW_03_Procurement_Part1_PR.md](./FLOW_03_Procurement_Part1_PR.md)**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- PR Creation (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ã‡∏∑‡πâ‡∏≠)
- Budget Check (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)
- Budget Reservation (‡∏à‡∏≠‡∏á‡∏á‡∏ö)
- PR Approval Workflow (‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠)

**‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:**
- ‚úÖ Complete PR workflow
- ‚úÖ UI Mockups (PR Form, PR List, Approval screens)
- ‚úÖ SQL examples ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
- ‚úÖ Budget integration
- ‚úÖ Validation ‡πÅ‡∏•‡∏∞ error handling

**Status Flow:**
```
draft ‚Üí submitted ‚Üí approved ‚Üí converted
```

#### Part 2: Purchase Order (PO)
üìÑ **‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô DATA_FLOW_COMPLETE_GUIDE.md**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- PO Creation from PR
- Trade Drug Selection
- Vendor Selection
- Budget Commitment
- PO Approval & Sending

#### Part 3: Goods Receipt
üìÑ **‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô DATA_FLOW_COMPLETE_GUIDE.md**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- Receipt Creation
- Lot Number Recording
- Expiry Date Tracking
- Inventory Update
- PO Closure

---

### 4Ô∏è‚É£ **FLOW 04: Inventory Management**
üìÑ **‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô DATA_FLOW_COMPLETE_GUIDE.md**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- Stock Level Tracking
- FIFO/FEFO Management
- Multi-location Support
- Transaction Logging
- Reorder Point Alerts

**Key Views:**
```sql
low_stock_items
expiring_drugs
current_stock_summary
```

**Key Functions:**
```sql
get_fifo_lots()
get_fefo_lots()
update_inventory_from_receipt()
```

---

### 5Ô∏è‚É£ **FLOW 05: Drug Distribution**
üìÑ **‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô DATA_FLOW_COMPLETE_GUIDE.md**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- Department Request
- Stock Availability Check
- FEFO Lot Selection
- Drug Dispensing
- Inventory Auto-update

**Tables:**
- drug_distributions
- drug_distribution_items

---

### 6Ô∏è‚É£ **FLOW 06: TMT Integration**
üìÑ **‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô DATA_FLOW_COMPLETE_GUIDE.md**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- Drug Code Mapping
- TMT Hierarchy (SUBS ‚Üí VTM ‚Üí GP ‚Üí TP ‚Üí GPU ‚Üí TPU ‚Üí GPP ‚Üí TPP)
- NC24 Assignment
- HIS Integration
- Ministry Standards Compliance

**Tables:**
- tmt_concepts (25,991 records)
- tmt_mappings
- his_drug_master

---

### 7Ô∏è‚É£ **FLOW 07: Ministry Reporting**
üìÑ **‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô DATA_FLOW_COMPLETE_GUIDE.md**

**‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:**
- 5 ‡πÅ‡∏ü‡πâ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç
  1. Druglist (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤)
  2. Purchase Plan (‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠)
  3. Receipt (‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏¢‡∏≤)
  4. Distribution (‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤)
  5. Inventory (‡∏¢‡∏≤‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á)
- Export Functions
- Data Validation
- Report Generation

**Views:**
```sql
export_druglist
export_purchase_plan
export_receipt
export_distribution
export_inventory
```

---

## üéØ **‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô**

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà:
1. **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà** QUICK_START_GUIDE.md - ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
2. **‡∏≠‡πà‡∏≤‡∏ô** DATA_FLOW_COMPLETE_GUIDE.md - ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
3. **‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞ Flow** ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö 01 ‚Üí 02 ‚Üí 03 ‚Üí ...

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Product Owner:
1. **‡∏≠‡πà‡∏≤‡∏ô** DATA_FLOW_COMPLETE_GUIDE.md - End-to-end example
2. **Review** UI Mockups ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Flow document
3. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö** Business rules ‡πÅ‡∏•‡∏∞ validation

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö QA/Tester:
1. **‡πÉ‡∏ä‡πâ** SQL examples ‡πÄ‡∏õ‡πá‡∏ô test cases
2. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö** Expected results ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
3. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö** Error handling scenarios

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö DBA:
1. **‡∏î‡∏π** Database Functions (prisma/functions.sql)
2. **‡∏î‡∏π** Database Views (prisma/views.sql)
3. **‡∏≠‡πà‡∏≤‡∏ô** Monitoring queries ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Flow

---

## üìä **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Folder**

```
docs/flows/
‚îú‚îÄ‚îÄ README.md                           # ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ
‚îú‚îÄ‚îÄ QUICK_START_GUIDE.md               # ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
‚îú‚îÄ‚îÄ DATA_FLOW_COMPLETE_GUIDE.md        # Master Index ‚≠ê
‚îú‚îÄ‚îÄ FLOW_01_Master_Data_Setup.md       # Setup ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
‚îú‚îÄ‚îÄ FLOW_02_Budget_Management.md       # ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
‚îî‚îÄ‚îÄ FLOW_03_Procurement_Part1_PR.md    # Purchase Request
```

---

## üîó **‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á**

### ‡πÉ‡∏ô docs/ (parent folder):
- **business-rules.md** - ‡∏Å‡∏é‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞ authorization matrix
- **system-flows.md** - Flow diagrams ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **TMT_SYSTEM_COMPLETE.md** - ‡∏£‡∏∞‡∏ö‡∏ö TMT ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- **legacy-analysis.md** - ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°

### ‡πÉ‡∏ô prisma/:
- **schema.prisma** - Database schema (32 tables)
- **views.sql** - Database views (11 views)
- **functions.sql** - Database functions (10 functions)
- **seed.ts** - Master data seeding script

---

## ‚úÖ **Quick Reference**

### System Components
- **32 Tables** - ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å workflow
- **11 Views** - Ministry + Operational reporting
- **10 Functions** - Budget + Inventory logic
- **6 Budget Types** - ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
- **5 Export Views** - ‡πÅ‡∏ü‡πâ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏™‡∏ò.
- **25,991 TMT Concepts** - Thai Medical Terminology

### Key Technologies
- **Database**: PostgreSQL 15
- **ORM**: Prisma
- **Language**: TypeScript
- **Container**: Docker
- **Port**: 5434

### Development URLs
- **pgAdmin**: http://localhost:8081
- **Prisma Studio**: http://localhost:5555

---

## üìû **‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô**

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠:
1. ‡∏î‡∏π‡∏ó‡∏µ‡πà **QUICK_START_GUIDE.md** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö troubleshooting
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö database logs: `docker logs invs-modern-db`
3. ‡∏î‡∏π console output: `npm run dev`

---

**Last Updated**: 2025-01-10
**Version**: 1.0.0
**Status**: Production Ready ‚úÖ

*Created with ‚ù§Ô∏è by Claude Code*
