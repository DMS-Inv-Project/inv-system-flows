# Master Data Export - INVS Modern v1.3.0

**Export Date:** 2025-10-20  
**Total Records:** 39  
**Total Tables:** 10

---

## 📊 Files

### 1. `master_data_export.sql` (Recommended) ✅
- Generated by `pg_dump`
- Complete with all data types and sequences
- Size: 12 KB
- Format: INSERT statements

### 2. `master_data_export_clean.sql` (Alternative)
- Custom formatted with section headers
- Easier to read
- Size: 13 KB

---

## 📋 Tables Included

| Table | Records | Description |
|-------|---------|-------------|
| `locations` | 5 | Storage locations |
| `departments` | 5 | Hospital departments (with HIS codes) |
| `bank` | 5 | Banks |
| `budget_types` | 3 | Budget type groups |
| `budget_categories` | 3 | Budget categories with accounting codes |
| `budgets` | 2 | Budget master records |
| `companies` | 5 | Companies/vendors (with bank info) |
| `drug_generics` | 5 | Generic drugs |
| `drugs` | 3 | Trade drugs (with pricing) |
| `budget_allocations` | 3 | 2025 budget allocations |

**Total:** 39 records

---

## 🚀 How to Import

### Method 1: Using psql (Recommended)

```bash
# Import to database
psql -U invs_user -d invs_modern < master_data_export.sql

# Or with Docker
docker exec -i invs-modern-db psql -U invs_user -d invs_modern < master_data_export.sql
```

### Method 2: Using Prisma

```bash
# Make sure database is empty
npm run db:push

# Run seed (which will create similar data)
npm run db:seed
```

---

## ⚠️ Important Notes

1. **Circular Foreign Keys:**
   - Some tables have self-referential foreign keys (departments.parent_id, locations.parent_id)
   - The export includes proper ordering to handle this

2. **Sequences:**
   - All sequences are reset to correct values at the end of the SQL file
   - This ensures new records get correct IDs

3. **Triggers:**
   - Import process disables triggers temporarily for faster loading
   - Re-enables them after completion

---

## 📊 Data Summary

### Locations
- MAIN - Main Warehouse
- PHARM - Central Pharmacy
- OPD - Outpatient Department
- ICU - Intensive Care Unit
- EMRG - Emergency Department

### Departments (with HIS codes)
- ADMIN (HIS-ADM)
- PHARM (HIS-PHARM)
- NURSE (HIS-NURSE)
- MED (HIS-MED)
- LAB (HIS-LAB)

### Banks
- ธนาคารกรุงไทย
- ธนาคารกสิกรไทย
- ธนาคารไทยพาณิชย์
- ธนาคารกรุงเทพ
- ธนาคารกรุงศรีอยุธยา

### Budget Hierarchy
```
Budget Types (3)
├─ 01 - งบเงินบำรุง
│  ├─ OP001 - เวชภัณฑ์ไม่ใช่ยา (1105010103.102)
│  └─ OP002 - ยา (1105010103.101)
├─ 02 - งบลงทุน
└─ 03 - งบบุคลากร
```

### Companies (all with bank info)
- GPO (both)
- Zuellig Pharma (vendor)
- Pfizer (manufacturer)
- Sino-Thai Engineering (vendor)
- Berlin Pharmaceutical (manufacturer)

### Drugs (all with pricing)
- GPO Paracetamol 500mg (1.50 ฿/TAB)
- GPO Ibuprofen 200mg (2.50 ฿/TAB)
- Zuellig Amoxicillin 250mg (3.00 ฿/CAP)

### Budget Allocations 2025
- PHARM: 10M (OP002 - ยา)
- NURSE: 5M (OP002 - ยา)
- MED: 3M (OP001 - เวชภัณฑ์)

**Total Budget 2025:** 18,000,000 บาท

---

## 🔧 Troubleshooting

### Error: "relation does not exist"
```bash
# Make sure tables are created first
npm run db:push
```

### Error: "duplicate key value"
```bash
# Clear existing data first
npm run db:push --force-reset
```

### Error: "permission denied"
```bash
# Use correct user
psql -U invs_user -d invs_modern < master_data_export.sql
```

---

## 📝 Version History

- **v1.3.0** (2025-10-20)
  - Added `hisCode` to departments
  - Added index on `departments.his_code`
  - Removed `budget_code` from departments
  - Changed table names to plural (budget_types, budget_categories, budgets)

---

**Generated by:** INVS Modern Database Export  
**Status:** ✅ Production Ready
